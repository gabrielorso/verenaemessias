<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Casamento Verena & Messias ‚Äî Confirma√ß√£o & Presentes</title>
  <meta name="description" content="Confirma√ß√£o de presen√ßa e lista de presentes do casamento." />
  <!-- Tipografia -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #faf7f5; --card:#fff; --text:#1f2937; --muted:#5f6b7a; --brand:#2e7d32;
      --brand-weak:#e5f3e8; --border:#e7e3de; --radius:14px; --shadow:0 6px 20px rgba(17,24,39,.06);
      /* üëâ troque a URL abaixo pela sua imagem */
      --bg-photo: url("img/foto-fundo.JPG");
      --overlay-light: rgba(250,247,245,.78);
      --overlay-dark: rgba(17,20,22,.70);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--text);background:var(--bg);
      font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.45;
    }
    /* Fundo com foto + sobreposi√ß√£o para legibilidade */
    body::before{
      content:""; position:fixed; inset:0; z-index:-1;
      background:
        linear-gradient(var(--overlay-light),var(--overlay-light)),
        var(--bg-photo) center/cover no-repeat fixed;
      transform:translateZ(0); /* evita flicker em alguns browsers */
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#111416; --card:#161a1d; --text:#f3f5f7; --muted:#9aa3ad; --border:#23282d; --brand-weak:#1c2a20; }
      body::before{
        background:
          linear-gradient(var(--overlay-dark),var(--overlay-dark)),
          var(--bg-photo) center/cover no-repeat fixed;
      }
    }

    a{color:var(--brand);text-decoration:none} a:hover{text-decoration:underline}

    /* Cabe√ßalho transl√∫cido com leve blur */
    header{
      padding:4rem 1rem 2rem; text-align:center; position:relative;
      background:rgba(255,255,255,.45); border-bottom:1px solid var(--border);
      -webkit-backdrop-filter:saturate(120%) blur(6px); backdrop-filter:saturate(120%) blur(6px);
    }
    .hero-title{
      font-family:"Playfair Display",serif; font-weight:700; letter-spacing:.5px;
      font-size:clamp(1.8rem,1.2rem + 2vw,3rem); margin:0 0 .5rem;
    }
    .hero-sub{ color:var(--muted); margin:0 auto; max-width:720px; font-size:1.05rem; }
    .nav{ display:inline-flex; gap:.5rem; margin-top:1rem; background:#fff; border:1px solid var(--border);
      border-radius:999px; padding:.35rem; box-shadow:var(--shadow); }
    .nav a{ padding:.5rem .9rem; border-radius:999px; font-weight:500; color:var(--text); }
    .nav a:hover{ background:#f5f5f5; text-decoration:none }
    .nav a.primary{ background:var(--brand); color:#fff } .nav a.primary:hover{ background:#256528 }

    main{ padding:0 1rem 3rem; max-width:1040px; margin-inline:auto }
    section{ margin:2rem 0 }
    h2{ font-family:"Playfair Display",serif; font-size:clamp(1.3rem,1rem + 1.2vw,2rem); margin:0 0 .75rem }
    p{ margin:.25rem 0 .9rem }

    .card, form{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:1.25rem; box-shadow:var(--shadow) }
    .grid{ display:grid; gap:1rem; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)) }
    .card img{ width:100%; height:180px; object-fit:cover; border-radius:10px; background:#f4f4f4 }
    .row{ display:flex; gap:.9rem; align-items:center }
    label{ display:block; font-size:.95rem; margin:.35rem 0; font-weight:500 }
    input,select,textarea{
      width:100%; padding:.7rem .8rem; border:1px solid #d6d3cf; border-radius:10px; background:#fff; font:inherit;
    }
    input:focus,select:focus,textarea:focus{ outline:2px solid #cfe8ff; border-color:#a7d3ff }
    .form-grid{ display:grid; gap:.9rem } @media(min-width:700px){ .form-grid.cols-2{ grid-template-columns:1fr 1fr } }

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:.5rem;
      padding:.75rem 1rem; border-radius:999px; border:1px solid #d0d0d0; background:#fff; cursor:pointer;
      font-weight:600; transition:transform .06s ease, background .15s ease, border-color .15s ease;
    }
    .btn:hover{ background:#f7f7f7 } .btn:active{ transform:translateY(1px) } .btn[disabled]{ opacity:.6; cursor:not-allowed }
    .btn-primary{ border-color:transparent; background:var(--brand); color:#fff; box-shadow:0 4px 14px rgba(46,125,50,.25) }
    .btn-primary:hover{ background:#256528 }
    .btn-outline{ border-color:var(--brand); color:var(--brand); background:#fff }
    .btn-outline:hover{ background:var(--brand-weak) }

    .muted{ color:var(--muted) } .ok{ color:#0e7a4e } .err{ color:#b00020 }
    .tag{ display:inline-block; padding:.25rem .7rem; border:1px solid var(--border); border-radius:999px; font-size:.85rem; color:var(--muted); background:#fff }
    footer{ padding:2rem 1rem; text-align:center; color:var(--muted); font-size:.95rem }

    /* Skeletons (loading) */
    .skeleton{ background:linear-gradient(90deg,#eee,#f7f7f7,#eee); background-size:200% 100%;
      animation:shimmer 1.2s infinite; border-radius:10px }
    @keyframes shimmer{ 0%{background-position:200% 0} 100%{background-position:-200% 0} }

    /* Dark tune */
    @media(prefers-color-scheme: dark){
      header{ background:rgba(22,26,29,.55); border-color:var(--border); }
      .nav{ background:var(--card) }
      .btn{ background:#1a1f23; border-color:#2a3036 }
      .btn:hover{ background:#20262b }
      .btn-outline{ background:transparent }
    }
  </style>
</head>
<body>
  <header>
    <h1 class="hero-title">Verena & Messias</h1>
    <p class="hero-sub">Confirme sua presen√ßa e, se desejar, escolha um presente com carinho. üíö</p>
    <nav class="nav" aria-label="Se√ß√µes">
      <a href="#rsvp" class="primary">Confirmar Presen√ßa</a>
      <a href="#gifts">Lista de Presentes</a>
    </nav>
  </header>

  <main>
    <section id="rsvp" aria-labelledby="rsvp-title">
      <h2 id="rsvp-title">Confirme sua Presen√ßa</h2>
      <form id="rsvpForm" class="card" novalidate>
        <div class="form-grid cols-2">
          <label>Nome completo
            <input name="name" autocomplete="name" required>
          </label>
          <label>E-mail
            <input type="email" name="email" autocomplete="email" required>
          </label>
        </div>

        <div class="form-grid cols-2">
          <label>Telefone/WhatsApp
            <input name="phone" autocomplete="tel">
          </label>
          <label>Vai comparecer?
            <select name="attending" required>
              <option value="">Selecione‚Ä¶</option>
              <option>Sim</option>
              <option>N√£o</option>
            </select>
          </label>
        </div>

        <div class="form-grid cols-2">
          <label>Adultos
            <input type="number" name="adults" min="0" value="1" inputmode="numeric">
          </label>
          <label>Crian√ßas
            <input type="number" name="children" min="0" value="0" inputmode="numeric">
          </label>
        </div>

        <label>Mensagem (opcional)
          <textarea name="message" rows="3" placeholder="Alguma observa√ß√£o, restri√ß√£o alimentar, etc."></textarea>
        </label>

        <div class="row" style="justify-content:space-between; gap:.6rem; margin-top:.5rem;">
          <small class="muted">Suas informa√ß√µes s√£o usadas apenas para a organiza√ß√£o do evento.</small>
          <button id="rsvpBtn" type="submit" class="btn btn-primary">Enviar confirma√ß√£o</button>
        </div>
        <div id="rsvpMsg" role="status" aria-live="polite" style="margin-top:.6rem"></div>
      </form>
    </section>

    <section id="gifts" aria-labelledby="gifts-title">
      <h2 id="gifts-title">Lista de Presentes</h2>
      <p class="muted">Os itens dispon√≠veis aparecem abaixo. Quando esgotar, somem automaticamente.</p>

      <div id="giftsGrid" class="grid" aria-live="polite">
        <div class="card"><div class="skeleton" style="width:100%;height:180px;"></div><div class="skeleton" style="height:14px;width:60%;margin-top:10px;"></div><div class="skeleton" style="height:14px;width:80%;margin-top:8px;"></div></div>
        <div class="card"><div class="skeleton" style="width:100%;height:180px;"></div><div class="skeleton" style="height:14px;width:70%;margin-top:10px;"></div><div class="skeleton" style="height:14px;width:65%;margin-top:8px;"></div></div>
        <div class="card"><div class="skeleton" style="width:100%;height:180px;"></div><div class="skeleton" style="height:14px;width:55%;margin-top:10px;"></div><div class="skeleton" style="height:14px;width:75%;margin-top:8px;"></div></div>
      </div>
      <div id="giftMsg" role="status" aria-live="polite" style="margin-top:.6rem"></div>
    </section>
  </main>

  <footer>
    <span class="tag">Casamento Verena & Messias</span>
  </footer>

  <script>
    // üîó URL do Apps Script (produ√ß√£o) que TERMINA EM /exec
    const API = 'https://script.google.com/macros/s/AKfycbzpgKG6r1Uo9pq3CwNuoAYSQLtVVDUSHGDkLrVha6EMaXP_cBxSpADdzhSJqK_m0zR_Qg/exec';

    const giftsGrid = document.getElementById('giftsGrid');
    const giftMsg   = document.getElementById('giftMsg');
    const rsvpForm  = document.getElementById('rsvpForm');
    const rsvpMsg   = document.getElementById('rsvpMsg');
    const rsvpBtn   = document.getElementById('rsvpBtn');

    function formatBRL(v){
      if (v === null || v === undefined || v === '') return '';
      const num = Number(String(v).replace(',', '.'));
      return isNaN(num) ? String(v) : num.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    }

    async function loadGifts(){
      try{
        const res = await fetch(API + '?action=gifts&ts=' + Date.now(), { method:'GET' });
        const ct = res.headers.get('content-type') || '';
        const text = await res.text();

        if (!ct.includes('application/json')){
          giftsGrid.innerHTML = '<div class="card err">Erro ao carregar presentes (verifique permiss√µes do Apps Script e se a URL termina em /exec).</div>';
          console.warn('Resposta n√£o JSON do GAS:', text.slice(0,500));
          return;
        }

        const data = JSON.parse(text);
        const gifts = data.gifts || [];
        if (!gifts.length){
          giftsGrid.innerHTML = '<div class="card"><strong>Todos os presentes j√° foram escolhidos üéâ</strong><p class="muted">Muito obrigado pelo carinho!</p></div>';
          return;
        }

        giftsGrid.innerHTML = gifts.map(g=>{
          const price = g.price ? `<p><strong>${formatBRL(g.price)}</strong></p>` : '';
          const desc  = g.description ? `<p class="muted">${g.description}</p>` : '';
          const img   = g.image_url ? `<img src="${g.image_url}" alt="${g.title}">` : '';
          const shop  = g.buy_link ? `<p><a href="${g.buy_link}" target="_blank" rel="noopener">Ver detalhe/loja</a></p>` : '';
          return `
            <article class="card" aria-label="${g.title}">
              ${img}
              <h3 style="margin:.6rem 0 .2rem">${g.title}</h3>
              ${desc}
              ${price}
              <p><small class="muted">Dispon√≠veis: ${g.remaining}</small></p>
              <div class="row" role="group" aria-label="Reservar ${g.title}">
                <input type="number" min="1" max="${g.remaining}" value="1" id="qty_${g.id}" aria-label="Quantidade para reservar">
                <button type="button" class="btn btn-outline" onclick="reserve('${g.id}', this)">Reservar</button>
              </div>
              ${shop}
            </article>
          `;
        }).join('');
      }catch(e){
        console.error(e);
        giftsGrid.innerHTML = '<div class="card err">Erro de conex√£o ao carregar presentes.</div>';
      }
    }

    async function reserve(gift_id, btnEl){
      giftMsg.textContent = '';
      const qtyInput = document.getElementById('qty_'+gift_id);
      const qty = Math.max(1, Number(qtyInput?.value || 1));
      const name = prompt('Seu nome completo:') || '';
      const email = prompt('Seu e-mail (para confirma√ß√£o):') || '';
      if (!name || !email){ giftMsg.innerHTML = '<span class="err">Nome e e-mail s√£o obrigat√≥rios.</span>'; return; }

      try{
        if (btnEl){ btnEl.disabled = true; btnEl.textContent = 'Reservando‚Ä¶'; }
        const body = new URLSearchParams({ action:'reserve', gift_id, qty:String(qty), name, email });
        const res  = await fetch(API, { method:'POST', body });
        const ct   = res.headers.get('content-type') || '';
        const txt  = await res.text();

        if (!ct.includes('application/json')){
          giftMsg.innerHTML = '<span class="err">Erro ao reservar (verifique o Apps Script).</span>';
          console.warn('Resposta n√£o JSON (reserve):', txt.slice(0,500));
          await loadGifts(); return;
        }

        const data = JSON.parse(txt);
        if (data.ok){
          giftMsg.innerHTML = '<span class="ok">Presente reservado com sucesso! Obrigado üíö</span>';
          await loadGifts();
        } else {
          giftMsg.innerHTML = '<span class="err">' + (data.error || 'N√£o foi poss√≠vel reservar') + '</span>';
          await loadGifts();
        }
      }catch(e){
        console.error(e);
        giftMsg.innerHTML = '<span class="err">Erro de conex√£o.</span>';
      }finally{
        if (btnEl){ btnEl.disabled = false; btnEl.textContent = 'Reservar'; }
      }
    }
    window.reserve = reserve;

    rsvpForm.addEventListener('submit', async (ev)=>{
      ev.preventDefault();
      rsvpMsg.textContent = '';
      rsvpBtn.disabled = true; rsvpBtn.textContent = 'Enviando‚Ä¶';

      const required = ['name','email','attending'];
      for (const n of required){
        const el = rsvpForm.elements[n];
        if (!el || !el.value){
          rsvpMsg.innerHTML = '<span class="err">Preencha os campos obrigat√≥rios.</span>';
          el?.focus();
          rsvpBtn.disabled = false; rsvpBtn.textContent = 'Enviar confirma√ß√£o';
          return;
        }
      }

      try{
        const fd = new FormData(rsvpForm); fd.append('action','rsvp');
        const res = await fetch(API, { method:'POST', body:new URLSearchParams(fd) });
        const ct  = res.headers.get('content-type') || ''; const txt = await res.text();

        if (!ct.includes('application/json')){
          rsvpMsg.innerHTML = '<span class="err">Erro ao enviar RSVP (verifique o Apps Script).</span>';
          console.warn('Resposta n√£o JSON (rsvp):', txt.slice(0,500));
          return;
        }

        const data = JSON.parse(txt);
        if (data.ok){
          rsvpMsg.innerHTML = '<span class="ok">RSVP enviado. Obrigado!</span>';
          rsvpForm.reset();
          document.querySelector('.nav a[href="#gifts"]')?.scrollIntoView({ behavior:'smooth', block:'center' });
        } else {
          rsvpMsg.innerHTML = '<span class="err">' + (data.error || 'N√£o foi poss√≠vel enviar o RSVP.') + '</span>';
        }
      }catch(e){
        console.error(e);
        rsvpMsg.innerHTML = '<span class="err">Erro de conex√£o.</span>';
      }finally{
        rsvpBtn.disabled = false; rsvpBtn.textContent = 'Enviar confirma√ß√£o';
      }
    });

    loadGifts();
  </script>
</body>
</html>
